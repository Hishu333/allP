<?xml version="1.0" ?>
<container
    xmlns="http://symfony.com/schema/dic/services"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://symfony.com/schema/dic/services http://symfony.com/schema/dic/services/services-1.0.xsd"
>
    <parameters>
        <parameter key="swag_extension_store.endpoints" type="collection">
            <parameter key="list_extensions">/swplatform/extensionstore/extensions</parameter>
            <parameter key="extension_detail">/swplatform/extensionstore/extensions/%d</parameter>
            <parameter key="filter">/swplatform/extensionstore/extensions/filter</parameter>
            <parameter key="reviews">/swplatform/extensionstore/extensions/%d/reviews</parameter>
            <parameter key="create_basket">/swplatform/extensionstore/baskets</parameter>
            <parameter key="order_basket">/swplatform/extensionstore/orders</parameter>
            <parameter key="payment_means">/swplatform/extensionstore/paymentmeans</parameter>
        </parameter>
    </parameters>
    <services>
        <!-- Authentication -->
        <service id="SwagExtensionStore\Authentication\InstanceServicePolyfill">
            <argument>%kernel.shopware_version%</argument>
            <argument>%instance_id%</argument>
        </service>

        <service id="SwagExtensionStore\Authentication\LocaleProviderPolyfill">
            <argument type="service" id="user.repository"/>
        </service>

        <service id="SwagExtensionStore\Authentication\StoreRequestOptionsProviderPolyfill">
            <argument type="service" id="user.repository"/>
            <argument type="service" id="Shopware\Core\System\SystemConfig\SystemConfigService"/>
            <argument type="service" id="SwagExtensionStore\Authentication\InstanceServicePolyfill"/>
            <argument type="service" id="SwagExtensionStore\Authentication\LocaleProviderPolyfill"/>
        </service>

        <service id="SwagExtensionStore\Authentication\StoreRequestOptionsProviderWrapper">
            <argument type="service" id="SwagExtensionStore\Authentication\StoreRequestOptionsProviderPolyfill"/>
            <argument type="service" id="Shopware\Core\Framework\Store\Authentication\StoreRequestOptionsProvider" on-invalid="null"/>
        </service>

        <!-- Controller -->
        <service id="SwagExtensionStore\Controller\LicenseController" public="true">
            <argument type="service" id="SwagExtensionStore\Services\LicenseService"/>
        </service>

        <service id="SwagExtensionStore\Controller\DataController" public="true">
            <argument type="service" id="SwagExtensionStore\Services\StoreDataProvider"/>
        </service>

        <!-- Services -->
        <service id="SwagExtensionStore\Services\LicenseService">
            <argument type="service" id="SwagExtensionStore\Services\StoreClient"/>
        </service>

        <service id="SwagExtensionStore\Services\StoreClient">
            <argument>%swag_extension_store.endpoints%</argument>
            <argument type="service" id="SwagExtensionStore\Authentication\StoreRequestOptionsProviderWrapper"/>
            <argument type="service" id="shopware.store_client"/>
        </service>

        <service id="SwagExtensionStore\Services\StoreDataProvider">
            <argument type="service" id="SwagExtensionStore\Services\StoreClient"/>
            <argument type="service" id="Shopware\Core\Framework\Store\Services\ExtensionLoader"/>
        </service>
    </services>
</container>
